<html>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <head>
        <title>LeaderBoard | PigeonHoleGames</title>
        <link rel="icon" href="/favicon.jpg">

        <link rel="stylesheet" href="/index.css">
        <script src="/index.js"></script>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">

    </head>
    <body>
        <header>
            <a href="index.html">PigeonHoleGames</a>
        </header>
        <h2 class="roundNumber">Round <span id="roundNumber">1</span> Results</h2>
        <h1 class="question" id="word">
            Word
        </h1>
        <div class="participantLobby" id="participantLobby">
            <div class="centerbox">
                <div class="waitingRoomContainer">
                    <div class="waitingRoomList">
                        <img id="boysCrown" src="/crown.png" style="max-width: 20px;">
                        Boys:
                        <ul id="boysList">
                            <li>test</li>
                            <li>test</li>
                            <li>test</li>
                        </ul>
                    </div>
                    <div class="waitingRoomList">
                        <img id="girlsCrown" src="/crown.png" style="max-width: 20px;">
                        Girls:
                        <ul id="girlsList"></ul>
                    </div>
                </div>
            </div>
        </div>

        <h2 class="roundNumber">LeaderBoard</h2>
        <div class="leaderboard">
            <div class="leader">1st Player One</div>
            <div class="leader">2nd Player Two</div>
            <div class="leader">3rd Player Three</div>

            <div class="button" id="nextRoundButton" onclick="nextRound()">Next Round</div>
            <div id="waitingForHost">Waiting for host to start the next round...</div>
        </div>

    </body>

    <script>
        boysList = [];
        girlsList = [];

        var gameCode = sessionStorage.getItem("gameCode");
        var isHost = sessionStorage.getItem("isHost");
        if (isHost == "false")
        {
            document.getElementById('nextRoundButton').style.display = "none";
            document.getElementById('waitingForHost').style.display = "block";
        }

        var roundNumber = sessionStorage.getItem("roundNumber");
        if (roundNumber == null)
        {
            roundNumber = 1
        }

        document.getElementById("roundNumber").innerHTML = roundNumber;

        var words = sessionStorage.getItem("words").split(",");
        word = words[(roundNumber-1)]
        document.getElementById("word").innerHTML = word;

        getPlayers(gameCode);

        async function getPlayers(gameCode, url = 'https://hjs0sxm035.execute-api.us-east-1.amazonaws.com/default/getPlayers') {

            postData = {"gameCode": gameCode}

            const response = await fetch(url, {
            method: 'post', 
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(postData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success');
                console.log(data);

                var boysUl = document.getElementById("boysList");
                var girlsUl = document.getElementById("girlsList");
                boysUl.innerHTML = "";
                girlsUl.innerHTML = "";

                for (i = 0; i < data['Count']; i++)
                {
                    playerName = data['Items'][i]['playerName']['S'];
                    lastAnswer = data['Items'][i]['lastAnswer']['S'];

                    if (lastAnswer == 'B')
                    {
                        boysList.push(playerName);

                        var li2 = document.createElement("li");
                        li2.appendChild(document.createTextNode(playerName));
                        boysUl.appendChild(li2);
                    }
                    else if (lastAnswer == 'G')
                    {
                        girlsList.push(playerName);

                        var li2 = document.createElement("li");
                        li2.appendChild(document.createTextNode(playerName));
                        girlsUl.appendChild(li2);
                    }
                }

                if (boysList.length > girlsList.length)
                {
                    document.getElementById('boysCrown').style.display = 'inline-block';
                }
                else if (girlsList.length > boysList.length)
                {
                    document.getElementById('girlsCrown').style.display = 'inline-block';
                }
                
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }




    </script>
</html>